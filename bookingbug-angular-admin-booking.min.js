(function(){'use strict';angular.module("BBAdminBooking",["BB","BBAdmin.Services","BBAdminServices","trNgGrid"]),angular.module("BBAdminBooking.Directives",[]),angular.module("BBAdminBooking.Services",["ngResource","ngSanitize"]),angular.module("BBAdminBooking.Controllers",["ngLocalData","ngSanitize"])}).call(this),function(){'use strict';angular.module("BBAdminBooking").config(["$logProvider",function(a){'ngInject';a.debugEnabled(!0)}])}.call(this),function(){'use strict';angular.module("BBAdminBooking").run(["$rootScope","$log","DebugUtilsService","$bbug","$document","$sessionStorage","FormDataStoreService","AppConfig","BBModel",function(a,b,c,d,e,f,g,h,i){'ngInject';i.Admin.Login.$checkLogin().then(function(){if(a.user&&a.user.company_id)return a.bb||(a.bb={}),a.bb.company_id=a.user.company_id})}])}.call(this),function(){var a=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a},b={}.hasOwnProperty;window.Collection.Client=function(b){function c(){return c.__super__.constructor.apply(this,arguments)}return a(c,b),c.prototype.checkItem=function(){return c.__super__.checkItem.apply(this,arguments)},c}(window.Collection.Base),angular.module("BB.Services").provider("ClientCollections",function(){return{$get:function(){return new window.BaseCollections}}})}.call(this),function(){'use strict';var a,b;angular.module("BB.Directives").directive("bbAdminCalendar",function(){return{restrict:"AE",replace:!0,scope:!0,controller:"BBAdminCalendarCtrl"}}),b=function(a,b,c,d,e,f){return angular.extend(this,c("TimeList",{$scope:a,$attrs:d,$element:b})),a.calendar_view={next_available:!1,day:!1,multi_day:!1},f.connection_started.then(function(){return a.initialise()}),a.initialise=function(){if(a.bb.item_defaults.pick_first_time?a.switchView("next_available"):null==a.bb.current_item.defaults.time?a.switchView(a.bb.item_defaults.day_view||"multi_day"):a.switchView("day"),a.bb.current_item.person&&(a.person_name=a.bb.current_item.person.name),a.bb.current_item.resource)return a.resource_name=a.bb.current_item.resource.name},a.switchView=function(b){var c,d,e,f,g,h,j;if("day"===b&&a.slots&&a.bb.current_item.time)for(f=a.slots,c=0,e=f.length;c<e;c++)if(h=f[c],h.time===a.bb.current_item.time.time){a.highlightSlot(h,a.bb.current_item.date);break}for(d in g=a.calendar_view,g)j=g[d],a.calendar_view[d]=!1;return a.calendar_view[b]=!0},a.pickTime=function(b){return a.bb.current_item.setDate({date:b.datetime}),a.bb.current_item.setTime(b),a.setLastSelectedDate(b.datetime),a.bb.current_item.reserve_ready?a.addItemToBasket().then(function(){return function(){return a.decideNextPage()}}(this)):a.decideNextPage()},a.pickOtherTime=function(){return a.availability_conflict=!1},a.setCloseBookings=function(b){return a.other_bookings=b},a.overBook=function(){var b,c;return c=new e.TimeSlot({time:a.bb.current_item.defaults.time,avail:1}),b=new e.Day({date:a.bb.current_item.defaults.datetime,spaces:1}),a.setLastSelectedDate(b.date),a.bb.current_item.setDate(b),a.bb.current_item.setTime(c),a.bb.current_item.setPerson(a.bb.current_item.defaults.person),a.bb.current_item.setResource(a.bb.current_item.defaults.resource),a.bb.current_item.reserve_ready?a.addItemToBasket().then(function(){return function(){return a.decideNextPage()}}(this)):a.decideNextPage()}},angular.module("BB.Controllers").controller("BBAdminCalendarCtrl",b),angular.module("BB.Directives").directive("bbAdminCalendarConflict",function(){return{restrict:"AE",replace:!0,scope:!0,controller:a}}),a=["$scope","$element","$controller","$attrs","BBModel",function(a,b,c,d,e){'ngInject';var f,g,h,j,k,l,m,n,o,p,q,r,s,t,u,v,w;if(w=a.bb.current_item.defaults.time,f=a.bb.current_item.duration,h=w+a.bb.current_item.duration,v=a.bb.current_item.defaults.datetime,s=a.bb.current_item.service,p=v.clone().add(-(s.pre_time||0),"minutes"),o=v.clone().add(f+(s.post_time||0),"minutes"),u=w-30,g=w+f+30,l=0,m=0,a.allow_overbook=a.bb.company.settings.has_overbook,a.slots)for(r=a.slots,k=0,n=r.length;k<n;k++)t=r[k],w>t.time&&(l=t.time,a.best_earlier=t),0===m&&t.time>w&&(m=t.time,a.best_later=t);0<l&&0<m&&l>w-f&&m<w+f&&(a.step_mismatch=!0),a.checking_conflicts=!0,j=function(){return null==a.bb.current_item.person?null==a.bb.current_item.defaults.person?void 0:a.bb.current_item.defaults.person.id:a.bb.current_item.person.id},q={src:a.bb.company,person_id:j(),resource_id:a.bb.current_item.defaults.resource?a.bb.current_item.defaults.resource_id:void 0,start_date:a.bb.current_item.defaults.datetime.format("YYYY-MM-DD"),start_time:sprintf("%02d:%02d",u/60,u%60),end_time:sprintf("%02d:%02d",g/60,g%60)},e.Admin.Booking.$query(q).then(function(b){return 0<b.items.length&&(a.nearby_bookings=_.filter(b.items,function(b){return a.bb.current_item.defaults.person&&b.person_id===a.bb.current_item.defaults.person.id||a.bb.current_item.defaults.resources&&b.resources_id===a.bb.current_item.defaults.resources.id}),a.overlapping_bookings=_.filter(a.nearby_bookings,function(a){var b,c;return c=moment(a.datetime).subtract(-(a.pre_time||0),"minutes"),b=moment(a.end_datetime).subtract(a.post_time||0,"minutes"),c.isBefore(o)&&b.isAfter(p)}),0===a.nearby_bookings.length&&(a.nearby_bookings=!1),0===a.overlapping_bookings.length&&(a.overlapping_bookings=!1)),!a.overlapping_bookings&&a.bb.company.$has("external_bookings")&&(q={start:a.bb.current_item.defaults.datetime.format("YYYY-MM-DD"),end:a.bb.current_item.defaults.datetime.clone().add(1,"day").format("YYYY-MM-DD"),person_id:a.bb.current_item.defaults.person?a.bb.current_item.defaults.person.id:void 0,resource_id:a.bb.current_item.defaults.resource?a.bb.current_item.defaults.resource_id:void 0},a.bb.company.$get("external_bookings",q).then(function(c){if(b=c.external_bookings,b&&0<b.length)return a.external_bookings=_.filter(b,function(a){return a.start_time=moment(a.start),a.end_time=moment(a.end),a.title||(a.title="Blocked"),a.start_time.isBefore(o)&&a.end_time.isAfter(p)})})),a.checking_conflicts=!1},function(){return a.checking_conflicts=!1})}]}.call(this),function(){'use strict';angular.module("BBAdminBooking").directive("bbAdminBookingClients",function(){return{restrict:"AE",replace:!1,scope:!0,controller:"adminBookingClients",templateUrl:"admin_booking_clients.html"}}),angular.module("BBAdminBooking").controller("adminBookingClients",["$scope","$rootScope","$q","AlertService","ValidatorService","ErrorService","$log","BBModel","$timeout","LoadingService","AdminBookingOptions","$translate",function(a,b,c,d,e,f,g,h,i,j,k,l){var m;return a.validator=e,a.admin_options=k,a.clients=new h.Pagination({page_size:10,max_size:5,request_page_size:10}),m=j.$loader(a),a.sort_by_options=[{key:"first_name",name:l.instant("ADMIN_BOOKING.CUSTOMER.SORT_BY_FIRST_NAME")},{key:"last_name",name:l.instant("ADMIN_BOOKING.CUSTOMER.SORT_BY_LAST_NAME")},{key:"email",name:l.instant("ADMIN_BOOKING.CUSTOMER.SORT_BY_EMAIL")}],a.sort_by=a.sort_by_options[0].key,b.connection_started.then(function(){return a.clearClient()}),a.selectClient=function(){return function(b,c){return a.setClient(b),a.client.setValid(!0),a.decideNextPage(c)}}(this),a.createClient=function(){return function(b){return m.notLoaded(),a.bb&&a.bb.parent_client&&(a.client.parent_client_id=a.bb.parent_client.id),a.client_details&&a.client.setClientDetails(a.client_details),h.Client.$create_or_update(a.bb.company,a.client).then(function(c){return m.setLoaded(),a.selectClient(c,b)},function(b){return b.data&&"Please Login"===b.data.error?(m.setLoaded(),d.raise("EMAIL_IN_USE")):b.data&&"Sorry, it appears that this phone number already exists"===b.data.error?(m.setLoaded(),d.raise("PHONE_NUMBER_IN_USE")):m.setLoadedAndShowError(a,b,"Sorry, something went wrong")})}}(this),a.getClients=function(b,c){if(null==c&&(c={}),a.search_triggered=!0,i(function(){return a.search_triggered=!1},1e3),b&&(!b||b.filter_by))return a.params={company:b.company||a.bb.company,per_page:b.per_page||a.clients.request_page_size,filter_by:b.filter_by,search_by_fields:b.search_by_fields||"phone,mobile",order_by:b.order_by||a.sort_by,order_by_reverse:b.order_by_reverse,page:b.page||1},k.use_default_company_id&&(a.params.default_company_id=a.bb.company.id),a.notLoaded(a),h.Admin.Client.$query(a.params).then(function(d){return a.search_complete=!0,c.add?a.clients.add(b.page,d.items):a.clients.initialise(d.items,d.total_entries),m.setLoaded()})},a.searchClients=function(b){var d,e;return d=c.defer(),e={filter_by:b,company:a.bb.company},k.use_default_company_id&&(e.default_company_id=a.bb.company.id),h.Admin.Client.$query(e).then(function(){return function(a){return d.resolve(a.items)}}(this)),d.promise},a.typeHeadResults=function(b,c,d){var e,f,g;return e=b,g=c,f=d,a.client=e,a.selectClient(b)},a.clearSearch=function(){return a.clients.initialise(),a.typeahead_result=null,a.search_complete=!1},a.edit=function(){return g.info("not implemented")},a.pageChanged=function(){var b,c,d;if(d=a.clients.update(),b=d[0],c=d[1],!b)return a.params.page=c,a.getClients(a.params,{add:!0})},a.sortChanged=function(b){return a.params.order_by=b,a.params.page=1,a.getClients(a.params)}}])}.call(this),function(){angular.module("BBAdminBooking").directive("bbAdminBooking",["BBModel","$log","$compile","$q","PathSvc","$templateCache","$http",function(a,b,c,d,e,f,g){var h,i,j;return h=function(a){var b,c,d;return c=a?a:"main",b=f.get(c),b?b:(d=e.directivePartial(c).$$unwrapTrustedValue(),g.get(d,{cache:f}).then(function(a){return a.data}))},j=function(a,b,e,f){return d.when(h(f)).then(function(d){return b.html(d).show(),e&&b.append("<style widget_css scoped></style>"),c(b.contents())(a)})},i=function(b,c,d){var e;if(e=b.$eval(d.bbAdminBooking),e||(e={}),e.admin=!0,d.companyId||(e.company_id?d.companyId=e.company_id:b.company&&(d.companyId=b.company.id)),d.companyId)return a.Admin.Company.$query(d).then(function(a){return b.company=a,b.initWidget(e),j(b,c,e.design_mode,e.template)})},{link:i,controller:"BBCtrl",controllerAs:"$bbCtrl",scope:!0}}])}.call(this),function(){angular.module("BBAdminBooking").directive("bbAdminBookingPopup",["AdminBookingPopup",function(a){return{restrict:"A",link:function(a,b){return b.bind("click",function(){return a.open()})},controller:["$scope",function(b){return b.open=function(){return a.open()}}]}}])}.call(this),function(){angular.module("BBAdminBooking").directive("bbAdminMemberBookingsTable",["$uibModal","$log","$rootScope","$compile","$templateCache","ModalForm","BBModel","Dialog","AdminMoveBookingPopup",function(a,b,c,d,e,f,g,h,i){var j;return j=function(a,d,e){var h,j;if(d.loading=!0,d.fields||(d.fields=["date_order","details"]),d.$watch("member",function(a){if(null!=a)return h(d,a)}),d.edit=function(a){var b;return b=_.find(d.booking_models,function(c){return c.id===a}),b.$getAnswers().then(function(a){var c,d,e,g;for(g=a.answers,d=0,e=g.length;d<e;d++)c=g[d],b["question"+c.question_id]=c.value;return f.edit({model:b,title:"Booking Details",templateUrl:"edit_booking_modal_form.html",success:function(a){var c;return"string"==typeof a?"move"===a?(c={person:b.person_id,resource:b.resource_id},i.open({item_defaults:c,company_id:b.company_id,booking_id:b.id,success:function(){return function(){return j(b)}}(this),fail:function(){return function(){return j(b)}}(this)})):void 0:j(b)}})})},j=function(a){return a.$refetch().then(function(a){var c;return a=new g.Admin.Booking(a),c=_.indexOf(d.booking_models,function(a){return a.id===id}),d.booking_models[c]=a,d.setRows()})},d.cancel=function(a){var b,c;return b=_.find(d.booking_models,function(c){return c.id===a}),c=e.open({templateUrl:"member_bookings_table_cancel_booking.html",controller:["$scope","$uibModalInstance","booking",function(a,b,c){return a.booking=c,a.booking.notify=!0,a.ok=function(){return b.close(a.booking)},a.close=function(){return b.dismiss()}}],scope:d,resolve:{booking:function(){return b}}}),c.result.then(function(a){var b;return d.loading=!0,b={notify:a.notify},a.$post("cancel",b).then(function(){var b;return b=_.findIndex(d.booking_models,function(c){return console.log(c),c.id===a.id}),d.booking_models.splice(b,1),d.setRows(),d.loading=!1})})},d.setRows=function(){return d.bookings=_.map(d.booking_models,function(a){return{id:a.id,date:moment(a.datetime).format("YYYY-MM-DD"),date_order:moment(a.datetime).format("x"),datetime:moment(a.datetime),details:a.full_describe}})},h=function(a,d){var e;return e={start_date:a.startDate.format("YYYY-MM-DD"),start_time:a.startTime?a.startTime.format("HH:mm"):void 0,end_date:a.endDate?a.endDate.format("YYYY-MM-DD"):void 0,end_time:a.endTime?a.endTime.format("HH:mm"):void 0,company:c.bb.company,url:c.bb.api_url,client_id:d.id,skip_cache:!0},g.Admin.Booking.$query(e).then(function(b){var c;return c=moment().unix(),a.booking_models=a.period&&"past"===a.period?_.filter(b.items,function(a){return a.datetime.unix()<c}):a.period&&"future"===a.period?_.filter(b.items,function(a){return a.datetime.unix()>c}):b.items,a.setRows(),a.loading=!1},function(c){return b.error(c.data),a.loading=!1})},d.startDate||(d.startDate=moment()),d.orderBy=d.defaultOrder,null==d.orderBy&&(d.orderBy="date_order"),d.now=moment(),d.member)return h(d,d.member)},{controller:j,templateUrl:"admin_member_bookings_table.html",scope:{apiUrl:"@",fields:"=?",member:"=",startDate:"=?",startTime:"=?",endDate:"=?",endTime:"=?",defaultOrder:"=?",period:"@"}}}])}.call(this),function(){'use strict';angular.module("BBAdminBooking").directive("bbAdminMoveBooking",["$log","$compile","$q","PathSvc","$templateCache","$http","BBModel","$rootScope",function(a,b,c,d,e,f,g,h){var i,j,k;return i=function(a){var b,c,g;return c=a?a:"main",b=e.get(c),b?b:(g=d.directivePartial(c).$$unwrapTrustedValue(),f.get(g,{cache:e}).then(function(a){return a.data}))},k=function(a,d,e,f){return c.when(i(f)).then(function(c){return d.html(c).show(),e&&d.append("<style widget_css scoped></style>"),b(d.contents())(a),a.decideNextPage("calendar")})},j=function(a,b,d){var e;if(e=a.$eval(d.bbAdminMoveBooking),e||(e={}),e.no_route=!0,e.admin=!0,e.template||(e.template="main"),d.companyId||(e.company_id?d.companyId=e.company_id:a.company&&(d.companyId=a.company.id)),d.companyId)return g.Admin.Company.$query(d).then(function(d){return a.initWidget(e),d.getBooking(e.booking_id).then(function(f){var i,j,l;return a.company=d,a.bb.moving_booking=f,a.quickEmptybasket(),l=[],j=new g.BasketItem(f,a.bb),j.setSrcBooking(f,a.bb),j.clearDateTime(),j.ready=!1,f.$has("client")&&(i=f.$get("client"),l.push(i),i.then(function(){return function(b){return a.setClient(new g.Client(b))}}(this))),Array.prototype.push.apply(l,j.promises),a.bb.basket.addItem(j),a.setBasketItem(j),c.all(l).then(function(){return h.$broadcast("booking:move"),a.setLoaded(a),k(a,b,e.design_mode,e.template)},function(){return a.setLoaded(a),failMsg()})})})},{link:j,controller:"BBCtrl",controllerAs:"$bbCtrl"}}])}.call(this),function(){angular.module("BBAdminBooking").factory("AdminMoveBookingPopup",["$uibModal","$timeout","$document",function(a){return{open:function(b){var c;return c=a.open({size:"lg",controller:["$scope","$uibModalInstance","config","$window","AdminBookingOptions",function(a,b,c,d,e){var f;return a.Math=d.Math,a.bb&&a.bb.current_item&&delete a.bb.current_item,a.config=angular.extend({clear_member:!0,template:"main"},c),a.company&&((f=a.config).company_id||(f.company_id=a.company.id)),a.config.item_defaults=angular.extend({merge_resources:e.merge_resources,merge_people:e.merge_people},c.item_defaults),a.cancel=function(){return b.dismiss("cancel")}}],templateUrl:"admin_move_booking_popup.html",resolve:{config:function(){return b}}}),c.result.then(function(a){return b.success&&b.success(),a},function(a){return b.fail&&b.fail(),a})}}}])}.call(this),function(){'use strict';var a;a=["$scope","$element","$attrs","BBModel","BookingCollections","$rootScope","BBAssets",function(a,b,c,d,e,f,g){'ngInject';var h,i;a.resources=[],a.resourceError=!1,g.getAssets(a.bb.company).then(function(b){return a.resources=b}),moment.isMoment(a.bb.to_datetime)||(a.bb.to_datetime=moment(a.bb.to_datetime)),moment.isMoment(a.bb.from_datetime)||(a.bb.from_datetime=moment(a.bb.from_datetime)),moment.isMoment(a.bb.to_datetime)||(a.bb.to_datetime=moment(a.bb.to_datetime)),a.bb.min_date&&!moment.isMoment(a.bb.min_date)&&(a.bb.min_date=moment(a.bb.min_date)),a.bb.max_date&&!moment.isMoment(a.bb.max_date)&&(a.bb.max_date=moment(a.bb.max_date)),a.all_day=!1,a.hideBlockAllDay=0<Math.abs(a.bb.from_datetime.diff(a.bb.to_datetime,"days")),a.bb.company_settings&&a.bb.company_settings.$has("block_questions")&&a.bb.company_settings.$get("block_questions",{}).then(function(){return function(b){return a.block_questions=new d.ItemDetails(b)}}(this)),a.blockTime=function(b){var c;return null==b?(console.error("blockTime requires form as first argument"),!1):(b.$setSubmitted(),!b.$invalid&&i())&&((a.loading=!0,c={start_time:a.bb.from_datetime,end_time:a.bb.to_datetime,booking:!0,allday:a.all_day},a.block_questions&&(c.questions=a.block_questions.getPostData()),"object"==typeof a.bb.current_item.person)?d.Admin.Person.$block(a.bb.company,a.bb.current_item.person,c).then(function(a){return h(a)}):"object"==typeof a.bb.current_item.resource?d.Admin.Resource.$block(a.bb.company,a.bb.current_item.resource,c).then(function(a){return h(a)}):void 0)},i=function(){return a.resourceError=!1,"object"!=typeof a.bb.current_item.person&&"object"!=typeof a.bb.current_item.resource&&(a.resourceError=!0),!!(("object"==typeof a.bb.current_item.person||"object"==typeof a.bb.current_item.resource)&&null!=a.bb.from_datetime&&a.bb.to_datetime)},h=function(){return f.$broadcast("refetchBookings"),a.loading=!1,a.cancel()},a.changeBlockDay=function(b){return a.all_day=b}}],angular.module("BBAdminBooking").directive("bbBlockTime",function(){return{scope:!0,restrict:"A",controller:a}})}.call(this),function(){angular.module("BB.Directives").directive("selectFirstSlot",function(){return{link:function(a){return a.$on("slotsUpdated",function(b,c,d){var e,f,g,h,j,k;for(d=_.filter(d,function(a){return a.time_moment.isAfter(moment())}),d[0]&&(a.bb.selected_slot=d[0],a.bb.selected_date=a.selected_date,e=d[0].time_24.split(":")[0],h=d[0].time_24.split(":")[1],a.bb.selected_date.hour(e).minutes(h).seconds(0),a.highlightSlot(d[0],a.selected_day)),j=[],(f=0,g=d.length);f<g;f++)k=d[f],k.selected||j.push(k.hidden=!0);return j})}}})}.call(this),function(){angular.module("BB.Filters").filter("in_the_future",function(){return function(a){var b,c;return c=moment(),b=c.minutes()+60*c.hours(),_.filter(a,function(a){return a.time>b})}}),angular.module("BB.Filters").filter("tod_from_now",function(){return function(a,b){var c,d,e,f,g,h,i,j,k,l;return(j=moment(),g=j.minutes()+60*j.hours(),k=a-g,c=b&&b.abbr_units?"hr":"hour",e=b&&b.abbr_units?"min":"minute",h=b&&angular.isString(b.seperator)?b.seperator:"and",l=parseInt(k),60>l)?l+" "+e+"s":(d=parseInt(l/60),f=l%60,0===f)?1===d?"1 "+c:d+" "+c+"s":(i=d+" "+c,1<d&&(i+="s"),0===f)?i:(0<h.length&&(i+=" "+h),i+=" "+f+" "+e+"s",i)}})}.call(this),function(){'use strict';angular.module("BB.Services").provider("AdminBookingOptions",function(){var a;a={merge_resources:!0,merge_people:!0,day_view:"multi_day",mobile_pattern:null,use_default_company_id:!1},this.setOption=function(b,c){a.hasOwnProperty(b)&&(a[b]=c)},this.$get=function(){return a}})}.call(this),function(){'use strict';angular.module("BBAdminBooking").factory("AdminBookingPopup",["$uibModal","$timeout","$document",function(a){return{open:function(b){return a.open({size:"lg",controller:["$scope","$uibModalInstance","config","$window","AdminBookingOptions",function(a,b,c,d,e){var f;return a.Math=d.Math,a.bb&&a.bb.current_item&&delete a.bb.current_item,a.config=angular.extend({clear_member:!0,template:"main"},c),a.company&&((f=a.config).company_id||(f.company_id=a.company.id)),a.config.item_defaults=angular.extend({merge_resources:e.merge_resources,merge_people:e.merge_people},c.item_defaults),a.cancel=function(){return b.dismiss("cancel")}}],templateUrl:"admin_booking_popup.html",resolve:{config:function(){return b}}})}}}])}.call(this),function(){'use strict';var a;a=["BBModel","$q","$translate",function(a,b,c){'ngInject';var d;return d=function(d){var e,f,g;return f=b.defer(),g=[],e=[],d.$has("people")&&g.push(a.Admin.Person.$query({company:d,embed:"immediate_schedule"}).then(function(a){var b,d,f;for(b=0,d=a.length;b<d;b++)f=a[b],f.title=f.name,null==f.identifier&&(f.identifier=f.id+"_p"),f.group=c.instant("ADMIN_BOOKING.ASSETS.STAFF_GROUP_LABEL");return e=_.union(e,a)})),d.$has("resources")&&g.push(a.Admin.Resource.$query({company:d,embed:"immediate_schedule"}).then(function(a){var b,d,f;for(b=0,d=a.length;b<d;b++)f=a[b],f.title=f.name,null==f.identifier&&(f.identifier=f.id+"_r"),f.group=c.instant("ADMIN_BOOKING.ASSETS.RESOURCES_GROUP_LABEL");return e=_.union(e,a)})),b.all(g).then(function(){return e.sort(function(c,a){return"person"===c.type&&"resource"===a.type?-1:"resource"===c.type&&"person"===a.type?1:c.name>a.name?1:c.name<a.name?-1:0}),f.resolve(e)}),f.promise},{getAssets:d}}],angular.module("BBAdminBooking").factory("BBAssets",a)}.call(this),function(){'use strict';angular.module("BBAdminBooking").factory("ProcessAssetsFilter",function(){return function(a){var b;return b=[],"undefined"==typeof a||""===a?b:angular.forEach(a.split(","),function(a){return b.push(parseInt(decodeURIComponent(a)))})}})}.call(this),function(){"use strict";angular.module("BBAdminBooking").config(["$translateProvider",function(a){"ngInject";var b;b={ADMIN_BOOKING:{ASSETS:{RESOURCES_GROUP_LABEL:"@:COMMON.TERMINOLOGY.RESOURCES",STAFF_GROUP_LABEL:"@:COMMON.TERMINOLOGY.STAFF"},CALENDAR:{STEP_HEADING:"Select a time",TIME_NOT_AVAILABLE_STEP_HEADING:"Time not available",ANY_PERSON_OPTION:"Any person",ANY_RESOURCE_OPTION:"Any resource",BACK_BTN:"@:COMMON.BTN.BACK",SELECT_BTN:"@:COMMON.BTN.SELECT",CALENDAR_PANEL_HEADING:"@:COMMON.TERMINOLOGY.CALENDAR",NOT_AVAILABLE:"Time not available: {{time}}",CONFLICT_EXISTS:"There's an availability conflict",CONFLICT_EXISTS_WITH_PERSON:"with {{person_name}}",CONFLICT_EXISTS_IN_RESOURCE:"in {{resource_name}}",CONFLICT_RESULT_OF:"This can be the result of:",CONFLICT_REASON_ALREADY_BOOKED:"The Staff/Resource being booked or blocked already",CONFLICT_REASON_NOT_ENOUGH_TIME:"Not enough available time to complete the booking before an existing one starts",CONFLICT_REASON_OUTSIDE:"The selected time being outside of the {{booking_time_step | time_period}} booking time step for {{service_name}}.",CONFLICT_ANOTHER_TIME_OR_OVERBOOK:"You can either use the calendar to choose another time or overbook.",DAY_VIEW_BTN:"Day",DAY_3_VIEW_BTN:"3 day",DAY_5_VIEW_BTN:"5 day",DAY_7_VIEW_BTN:"7 day",FIRST_FOUND_VIEW_BTN:"First available",TIME_SLOT_WITH_COUNTDOWN:"{{datetime}} (in {{time | tod_from_now}})",NOT_FOUND:"No availability found",NOT_FOUND_TRY_DIFFERENT_TIME_RANGE:"No availability found, try a different time-range",OVERBOOK_WARNING:"Overbooking ignores booking time step and availability constraints to make a booking.",FILTER_BY_LBL:"Filter by",SELECT_A_TIME_FOR_BOOKING:"Select a time for the booking.",OVERLAPPING_BOOKINGS:"The following bookings look like they are clashing with this requested time",NEARBY_BOOKINGS:"The following nearby bookings might be clashing with this requested time",EXTERNAL_BOOKINGS:"The following external calendar bookings look like they are clashing with this requested time",EXTERNAL_BOOKING_DESCRIPTION:"{{title}} from {{from}} to {{to}}",ALTERNATIVE_TIME_NO_OVERBOOKING:"It looks like the booking step that service was configured for doesn't allow that time. You can select an alternative time, or you can try booking the requested time anyway, however making double bookings is not allowed by your business configuration settings",ALTERNATIVE_TIME_ALLOW_OVERBOOKING:"The following external calendar bookings look like they are clashing with this requested time",CLOSEST_TIME_NO_OVERBOOKING:"Looks like that time wasn't available. This could just be because it would be outside of their normal schedule. This was the closest time I found. You can select an alternative time, or you can try booking the requested time anyway, however double bookings aren't allowed by your company configuration settings",CLOSEST_TIME_ALLOW_OVERBOOKING:"Looks like that time wasn't available. This could just be because it would be outside of their normal schedule. This was the closest time I found. You can select an alternative time, or you can try booking the requested time anyway",CLOSEST_EARLIER_TIME_BTN:"Closest Earlier: {{closest_earlier}}",CLOSEST_LATER_TIME_BTN:"Closest Later: {{closest_later}}",REQUESTED_TIME_BTN:"Requested Time: {{requested_time}}",FIND_ANOTHER_TIME_BTN:"Find another time",MORNING_HEADER:"@:COMMON.TERMINOLOGY.MORNING",AFTERNOON_HEADER:"@:COMMON.TERMINOLOGY.AFTERNOON",EVENING_HEADER:"@:COMMON.TERMINOLOGY.EVENING"},CUSTOMER:{BACK_BTN:"@:COMMON.BTN.BACK",CLEAR_BTN:"@:COMMON.BTN.CLEAR",CREATE_HEADING:"Create Customer",CREATE_BTN:"Create Customer",CREATE_ONE_INSTEAD_BTN:"Create one instead",EMAIL_LBL:"@:COMMON.TERMINOLOGY.EMAIL",FIRST_NAME_LBL:"@:COMMON.TERMINOLOGY.FIRST_NAME",LAST_NAME_LBL:"@:COMMON.TERMINOLOGY.LAST_NAME",MOBILE_LBL:"@:COMMON.TERMINOLOGY.MOBILE",NO_RESULTS_FOUND:"No results found",NUM_CUSTOMERS:"{CUSTOMERS_NUMBER, plural, =0{no customers} =1{one customer} other{{CUSTOMERS_NUMBER} customers}} found",SEARCH_BY_PLACEHOLDER:"Search\xA0by\xA0email or name",STEP_HEADING:"Select a customer",SELECT_BTN:"@:COMMON.BTN.SELECT",SORT_BY_LBL:"Sort by",SORT_BY_EMAIL:"@:COMMON.TERMINOLOGY.EMAIL",SORT_BY_FIRST_NAME:"@:COMMON.TERMINOLOGY.FIRST_NAME",SORT_BY_LAST_NAME:"@:COMMON.TERMINOLOGY.LAST_NAME",ADDRESS1_LBL:"@:COMMON.TERMINOLOGY.ADDRESS1",ADDRESS1_VALIDATION_MSG:"Please enter an address",ADDRESS3_LBL:"@:COMMON.TERMINOLOGY.ADDRESS3",ADDRESS4_LBL:"@:COMMON.TERMINOLOGY.ADDRESS4",POSTCODE_LBL:"@:COMMON.TERMINOLOGY.POSTCODE"},QUICK_PICK:{BLOCK_WHOLE_DAY:"Block whole day",BLOCK_TIME_TAB_HEADING:"Block time",MAKE_BOOKING_TAB_HEADING:"Make booking",PERSON_LABEL:"@:COMMON.TERMINOLOGY.PERSON",PERSON_DEFAULT_OPTION:"Any Person",RESOURCE_LABEL:"@:COMMON.TERMINOLOGY.RESOURCE",RESOURCE_DEFAULT_OPTION:"Any Resource",FROM_LBL:"From",SERVICE_LABEL:"Select a service",SERVICE_DEFAULT_OPTION:"-- select --",SERVICE_REQUIRED_MSG:"Please select a service",TO_LBL:"To",YES_OPTION:"@:COMMON.BTN.YES",NO_OPTION:"@:COMMON.BTN.NO",NEXT_BTN:"@:COMMON.BTN.NEXT",FIELD_REQUIRED:"@:COMMON.FORM.FIELD_REQUIRED"},BOOKINGS_TABLE:{CANCEL_BTN:"@:COMMON.BTN.CANCEL",DETAILS_BTN:"@:COMMON.BTN.DETAILS"},ADMIN_MOVE_BOOKING:{CANCEL_CONFIRMATION_HEADING:"Your booking has been cancelled.",HEADING:"Your {{service_name}} booking",CUSTOMER_NAME_LBL:"@:COMMON.TERMINOLOGY.NAME",PRINT_BTN:"@:COMMON.TERMINOLOGY.PRINT",EMAIL_LBL:"@:COMMON.TERMINOLOGY.EMAIL",SERVICE_LBL:"@:COMMON.TERMINOLOGY.SERVICE",WHEN_LBL:"@:COMMON.TERMINOLOGY.WHEN",PRICE_LBL:"@:COMMON.TERMINOLOGY.PRICE",CANCEL_BOOKING_BTN:"@:COMMON.BTN.CANCEL_BOOKING",MOVE_BOOKING_BTN:"Move booking",BOOK_WAITLIST_ITEMS_BTN:"Book Waitlist Items"},CHECK_ITEMS:{BOOKINGS_QUESTIONS_HEADING:"Booking Questions",PRIVATE_BOOKING_NOTES_HEADING:"Private Notes",BOOK_BTN:"@:COMMON.BTN.BOOK",BACK_BTN:"@:COMMON.BTN.BACK"},CONFIRMATION:{TITLE:"@:COMMON.TERMINOLOGY.CONFIRMATION",BOOKING_CONFIRMATION:"Booking is now confirmed.",EMAIL_CONFIRMATION:"An email has been sent to {{customer_name}} with the details below.",WAITLIST_CONFIRMATION:"You have successfully made the following bookings.",PRINT_BTN:"@:COMMON.TERMINOLOGY.PRINT",PURCHASE_REF_LBL:"Reference",CUSTOMER_LBL:"@:COMMON.TERMINOLOGY.BOOKING_REF",SERVICE_LBL:"@:COMMON.TERMINOLOGY.SERVICE",DATE_TIME_LBL:"@:COMMON.TERMINOLOGY.DATE_TIME",TIME_LBL:"@:COMMON.TERMINOLOGY.TIME",PRICE_LBL:"@:COMMON.TERMINOLOGY.PRICE",CLOSE_BTN:"@:COMMON.BTN.CLOSE"}}},a.translations("en",b)}])}.call(this),function(){'use strict';var a;angular.module("BBAdminBooking").component("bbAdminResourcesDropdown",{bindings:{formCtrl:"<"},controller:"BBAdminResourcesDropdownCtrl",controllerAs:"$bbAdminResourcesDropdownCtrl",require:{$bbCtrl:"^^bbAdminBooking"},templateUrl:"admin-booking/admin_resources_dropdown.html"}),a=["BBAssets","$rootScope","$scope",function(a,b,c){'ngInject';var d,e,f,g;this.pickedResource=null,this.resources=[],this._resourceChangedUnSubscribe=null,this.$onInit=function(b){return function(){b.changeResource=d,a.getAssets(b.$bbCtrl.$scope.bb.company).then(g),b._resourceChangedUnSubscribe=c.$on("bbAdminResourcesDropdown:resourceChanged",e)}}(this),this.$onDestroy=function(a){return function(){a._resourceChangedUnSubscribe()}}(this),e=function(a){return function(){var b,c,d,e,f,g;if(null==a.pickedResource)return delete a.$bbCtrl.$scope.bb.current_item.resource,void delete a.$bbCtrl.$scope.bb.current_item.person;for(g=a.pickedResource.split("_")[1],d=a.resources,(f=b=0,c=d.length);b<c;f=++b)if(e=d[f],e.identifier===a.pickedResource){"p"===g?(a.$bbCtrl.$scope.bb.current_item.person=e,a.pickedResource=e,delete a.$bbCtrl.$scope.bb.current_item.resource):"r"===g&&(a.$bbCtrl.$scope.bb.current_item.resource=e,a.pickedResource=e,delete a.$bbCtrl.$scope.bb.current_item.person);break}}}(this),g=function(a){return function(b){a.resources=b,f()}}(this),f=function(a){return function(){null!=a.$bbCtrl.$scope.bb.current_item.person&&null!=a.$bbCtrl.$scope.bb.current_item.person.id?(a.pickedResource=a.$bbCtrl.$scope.bb.current_item.person,a.pickedResource.identifier=a.$bbCtrl.$scope.bb.current_item.person.id+"_p"):null!=a.$bbCtrl.$scope.bb.current_item.resource&&null!=a.$bbCtrl.$scope.bb.current_item.resource.id&&(a.pickedResource=a.$bbCtrl.$scope.bb.current_item.resource,a.pickedResource.identifier=a.$bbCtrl.$scope.bb.current_item.resource.id+"_r")}}(this),d=function(){return function(){b.$broadcast("bbAdminResourcesDropdown:resourceChanged")}}(this)}],angular.module("BBAdminBooking").controller("BBAdminResourcesDropdownCtrl",a)}.call(this);